<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];
                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));
                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }
                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Living & Non-Living Things - P4 Science</title>
     <link rel="icon" href="static/logo2.png" type="image/icon type">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
             margin: 0;
             font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
             background: #f1f5f9;
             overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: #0360a5;
        }
        
        .slide-modal {
             width: 100vw;
             height: 100vh;
             background: #f1f5f9;
             display: flex;
             align-items: stretch;
             justify-content: center;
             transition: padding-left 0.3s ease;
            position: relative;
        }
        
        .slide-modal.sidebar-open { padding-left: 280px; }
        
        .sidebar {
            width: 280px;
            background: #ffffff;
            border-right: 1px solid #e5e7eb;
            padding: 20px 0 0 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
            overflow-y: auto;
            position: fixed;
            left: -280px;
            top: 0;
            height: 100vh;
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            -webkit-overflow-scrolling: touch;
        }
        
        .sidebar.open { left: 0; }
        
        .menu-toggle {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 1001;
            background: linear-gradient(135deg, #0360a5, #2c4a7e);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 14px;
            cursor: pointer;
            font-size: 1.3rem;
            box-shadow: 0 3px 12px rgba(26,42,68,0.3);
            transition: all 0.3s ease;
            min-height: 50px;
            min-width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .menu-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26,42,68,0.4);
        }
        
        .menu-toggle.sidebar-open {
            left: 16px;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: none;
        }
        
        .subtopic-section {
            margin-bottom: 16px;
        }
        .subtopic-header {
            background: #e5e7eb;
            padding: 12px 20px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #0360a5;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .subtopic-btn {
            background: none;
            border: none;
            text-align: left;
            padding: 14px 24px;
            font-size: 0.95rem;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
            width: 100%;
            display: block;
            min-height: 50px;
            line-height: 1.5;
        }
        .subtopic-btn.active, .subtopic-btn:hover {
            background: #e6f0fa;
            color: #1a2a44;
            border-left: 4px solid #2c4a7e;
            font-weight: 600;
        }
        
        .slide-container {
             background: #ffffff;
             border-radius: 12px;
             width: 100vw;
             max-width: none;
             height: 95vh;
             box-shadow: 0 6px 24px rgba(0,0,0,0.1);
             display: flex;
             flex-direction: column;
             flex: 1;
             margin: 12px;
            position: relative;
        }
        
        .slide-header {
             background: linear-gradient(135deg, #1a2a44, #2c4a7e);
             color: white;
             padding: 20px 32px;
             display: flex;
             justify-content: space-between;
             align-items: center;
             flex-shrink: 0;
            border-radius: 12px 12px 0 0;
        }
        .slide-title {
             font-size: 1.5rem;
             font-weight: 700;
             display: flex;
             align-items: center;
             gap: 12px;
             margin: 0;
            letter-spacing: -0.02em;
        }
        .slide-counter {
             background: rgba(255,255,255,0.15);
             padding: 8px 16px;
             border-radius: 20px;
             font-weight: 600;
             font-size: 0.9rem;
        }
        
        .slide-content {
             flex: 1;
             overflow-y: auto;
             display: flex;
             flex-direction: column;
            background: #f8fafc;
             padding: 24px;
            -webkit-overflow-scrolling: touch;
        }
        
        .main-slide-area {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }
        
        .slide {
             width: 100%;
             max-width: 900px;
             margin: 0 auto;
             padding: 32px 24px;
             background: #ffffff;
             border-radius: 16px;
             box-shadow: 0 4px 20px rgba(26,42,68,0.08);
             display: flex;
             flex-direction: column;
             align-items: center;
             text-align: center;
            line-height: 1.6;
        }
        
        .slide h2, .slide h3 {
            color: #0360a5;
            margin-bottom: 16px;
            font-weight: 700;
        }
        
        .slide p {
            color: #374151;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 16px;
            line-height: 1.7;
        }

        .slide-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
            width: 100%;
            max-width: 700px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
            width: 100%;
            max-width: 700px;
        }

        .info-card {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .info-card h4 {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #0360a5;
        }

        .info-card p {
            font-size: 0.95rem;
            margin: 0;
        }

        .info-card ul {
            text-align: left;
            margin: 10px 0;
            padding-left: 20px;
        }

        .info-card li {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .green-card { background: linear-gradient(135deg, #d4f4dd 0%, #a7f3d0 100%); }
        .blue-card { background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%); }
        .purple-card { background: linear-gradient(135deg, #e9d5ff 0%, #c4b5fd 100%); }
        .yellow-card { background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); }
        .orange-card { background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%); }
        .red-card { background: linear-gradient(135deg, #fecaca 0%, #f87171 100%); }
        .gray-card { background: linear-gradient(135deg, #f3f4f6 0%, #d1d5db 100%); }

        .mrs-gren {
            background: linear-gradient(135deg, #d4f4dd 0%, #a7f3d0 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            max-width: 600px;
            text-align: left;
        }

        .mrs-gren h4 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #065f46;
            text-align: center;
        }

        .mrs-gren ul {
            list-style: none;
            padding: 0;
        }

        .mrs-gren li {
            padding: 8px 0;
            font-size: 1rem;
            color: #047857;
        }

        .mrs-gren strong {
            color: #064e3b;
            font-size: 1.1rem;
        }

        .video-container {
            width: 100%;
            max-width: 700px;
            margin: 24px 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .video-placeholder {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #0360a5, #2c4a7e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            border-radius: 12px;
            text-align: center;
            padding: 20px;
        }
        
        .slide-navigation {
             background: #ffffff;
             padding: 20px 32px;
             display: flex;
             justify-content: space-between;
             align-items: center;
             border-top: 1px solid #e5e7eb;
             flex-shrink: 0;
            border-radius: 0 0 12px 12px;
        }
        
        .nav-btn {
             background: linear-gradient(135deg, #1a2a44, #2c4a7e);
             color: white;
             border: none;
             border-radius: 10px;
             padding: 12px 24px;
             font-size: 1rem;
             font-weight: 600;
             cursor: pointer;
             min-height: 50px;
            transition: all 0.2s ease;
        }
        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26,42,68,0.3);
        }
        .nav-btn:disabled {
             opacity: 0.5;
             cursor: not-allowed;
             transform: none;
            box-shadow: none;
        }
        .slide-progress {
             display: flex;
             gap: 8px;
             align-items: center;
             flex-wrap: wrap;
            justify-content: center;
        }
        .progress-dot {
             width: 10px;
             height: 10px;
             border-radius: 50%;
             background: #d1d5db;
             transition: all 0.2s ease;
        }
        .progress-dot.active {
             background: linear-gradient(135deg, #1a2a44, #2c4a7e);
            transform: scale(1.3);
        }
        
        /* Notes Section */
        .notes-section {
            background: #ffffff;
            border-radius: 12px;
            margin-top: 24px;
            padding: 24px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06);
            border-top: 3px solid #2c4a7e;
        }
        
        .notes-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            color: #0360a5;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .notes-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            align-items: start;
        }
        
        .notes-text {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #374151;
        }
        
        .notes-images {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .bw-image {
            width: 100%;
            height: 120px;
            background: #f7f7f7;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            color: #6b7280;
            filter: grayscale(100%);
            position: relative;
            overflow: hidden;
            text-align: center;
            padding: 12px;
        }
        
        .bw-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, #f3f4f6 25%, transparent 25%),
                         linear-gradient(-45deg, #f3f4f6 25%, transparent 25%),
                         linear-gradient(45deg, transparent 75%, #f3f4f6 75%),
                         linear-gradient(-45deg, transparent 75%, #f3f4f6 75%);
            background-size: 15px 15px;
            background-position: 0 0, 0 7.5px, 7.5px -7.5px, -7.5px 0px;
            opacity: 0.1;
        }
        
        /* AI Help Floating Widget */
        .ai-help-widget {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 1002;
            font-family: inherit;
        }
        
        .ai-help-toggle {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
            transition: all 0.3s ease;
        }
        
        .ai-help-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(16, 185, 129, 0.5);
        }
        
        .ai-help-toggle.active {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
        }
        
        .ai-help-panel {
            position: absolute;
            top: 70px;
            right: 0;
            width: 340px;
            max-height: 480px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border: 1px solid #e5e7eb;
            transform: translateY(-20px) scale(0.95);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .ai-help-panel.open {
            transform: translateY(0) scale(1);
            opacity: 1;
            visibility: visible;
        }
        
        .ai-help-header {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 16px 20px;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }
        
        .ai-help-content {
            padding: 20px;
            max-height: 320px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .ai-chat-messages {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
            min-height: 80px;
        }
        
        .ai-message {
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 0.85rem;
            line-height: 1.5;
            word-wrap: break-word;
        }
        
        .ai-message.user {
            background: #e6f0fa;
            color: #1a2a44;
            align-self: flex-end;
            max-width: 80%;
        }
        
        .ai-message.bot {
            background: #f0fdf4;
            color: #166534;
            align-self: flex-start;
            max-width: 90%;
        }
        
        .ai-input-area {
            display: flex;
            gap: 8px;
            border-top: 1px solid #e5e7eb;
            padding-top: 16px;
        }
        
        .ai-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.2s;
            min-height: 40px;
        }
        
        .ai-input:focus {
            border-color: #10b981;
        }
        
        .ai-send-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            flex-shrink: 0;
        }
        
        .ai-send-btn:hover {
            transform: scale(1.05);
        }
        
        .ai-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .ai-suggestion {
            background: #f3f4f6;
            color: #374151;
            border: none;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 36px;
        }
        
        .ai-suggestion:hover {
            background: #e6f0fa;
            color: #1a2a44;
        }

        /* Quiz Styles */
        .quiz-option {
             background: #ffffff;
             border: 2px solid #e5e7eb;
             border-radius: 10px;
             padding: 16px 20px;
             cursor: pointer;
             margin: 8px 0;
             font-size: 1rem;
             width: 100%;
            max-width: 600px;
            transition: all 0.2s ease;
            min-height: 50px;
            text-align: left;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .quiz-option:hover {
            border-color: #2c4a7e;
            transform: translateY(-1px);
        }
        .quiz-option.selected {
             background: #e6f0fa;
             border-color: #2c4a7e;
             color: #1a2a44;
         }
        .quiz-option.correct {
             background: #dcfce7;
             border-color: #22c55e;
             color: #15803d;
         }
        .quiz-option.incorrect {
             background: #fee2e2;
             border-color: #dc2626;
             color: #b91c1c;
         }
        .quiz-explanation {
             background: #f0fdf4;
             border-radius: 10px;
             padding: 20px;
             border-left: 4px solid #22c55e;
             margin-top: 20px;
             display: none;
             max-width: 600px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .quiz-explanation.show { display: block; }
        
        .back-home-btn {
            background: #ffffff;
            color: #2c4a7e;
            font-weight: 600;
            border-radius: 10px;
            padding: 8px 16px;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(26,42,68,0.1);
            font-size: 0.9rem;
            border: none;
            margin-left: 12px;
            transition: all 0.2s ease;
            min-height: 40px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .back-home-btn:hover {
            background: #e6f0fa;
            color: #1a2a44;
        }
        
        /* Overlay for mobile menu */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
            transition: opacity 0.3s ease;
        }
        
        .sidebar-overlay.show {
            display: block;
            opacity: 1;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .slide-modal {
                 padding-left: 0 !important;
             }
            .slide-modal.sidebar-open {
                 padding-left: 0;
             }
            
            .menu-toggle {
                 top: 12px;
                left: 12px;
                min-height: 48px;
                min-width: 48px;
                font-size: 1.2rem;
                border-radius: 8px;
            }
            
            .menu-toggle.sidebar-open {
                 left: 12px;
                 background: linear-gradient(135deg, #dc2626, #b91c1c);
                transform: none;
            }
            
            .sidebar {
                 width: 85vw;
                max-width: 320px;
                border-radius: 0 16px 16px 0;
                padding-top: 70px;
            }
            
            .subtopic-header {
                 font-size: 0.8rem;
                padding: 12px 20px;
                letter-spacing: 0.4px;
            }
            
            .subtopic-btn {
                 padding: 14px 22px;
                 font-size: 0.95rem;
                min-height: 50px;
                line-height: 1.5;
            }
            
            .slide-container {
                 width: 100vw;
                 height: 100vh;
                 border-radius: 0;
                 margin: 0;
            }
            
            .slide-header {
                padding: 16px 20px;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .slide-title {
                font-size: 1.2rem;
                gap: 8px;
            }
            
            .slide-counter {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            .slide {
                 padding: 20px 16px;
                 border-radius: 0;
                 margin: 0;
            }
            
            .slide h2, .slide h3 {
                font-size: 1.3rem;
                margin-bottom: 12px;
            }
            
            .slide p {
                font-size: 1rem;
                line-height: 1.6;
            }

            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .slide-navigation {
                 padding: 16px 20px;
                flex-wrap: wrap;
                gap: 12px;
            }
            
            .nav-btn {
                font-size: 0.9rem;
                padding: 10px 20px;
                min-height: 48px;
            }
            
            .slide-progress {
                order: -1;
                width: 100%;
                justify-content: center;
                margin-bottom: 8px;
            }
            
            .progress-dot {
                width: 8px;
                height: 8px;
            }
            
            .back-home-btn {
                 font-size: 0.8rem;
                 padding: 6px 12px;
                 margin-left: 8px;
                gap: 4px;
                min-height: 40px;
            }
            
            .video-container {
                margin: 16px 0;
            }
            
            .video-placeholder {
                height: 180px;
                font-size: 0.9rem;
                padding: 16px;
            }
            
            .notes-content {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .notes-text {
                font-size: 0.9rem;
            }
            
            .bw-image {
                height: 100px;
                font-size: 0.8rem;
            }
            
            .ai-help-widget {
                top: 12px;
                right: 12px;
            }
            
            .ai-help-toggle {
                width: 52px;
                height: 52px;
                font-size: 1.3rem;
            }
            
            .ai-help-panel {
                width: calc(100vw - 40px);
                max-width: 320px;
                top: 70px;
                right: 10px;
                max-height: 400px;
            }
            
            .ai-help-header {
                padding: 14px 16px;
                font-size: 0.9rem;
            }
            
            .ai-help-content {
                padding: 16px;
                max-height: 280px;
            }
            
            .ai-message {
                font-size: 0.8rem;
                padding: 8px 10px;
            }
            
            .ai-input {
                font-size: 16px;
                padding: 10px 12px;
            }
            
            .ai-suggestion {
                font-size: 0.7rem;
                padding: 6px 10px;
                min-height: 36px;
            }
            
            .quiz-option {
                font-size: 0.95rem;
                padding: 14px 16px;
                margin: 6px 0;
                min-height: 50px;
            }
            
            .quiz-explanation {
                font-size: 0.9rem;
                padding: 16px;
                margin-top: 16px;
            }
        }

        /* Small mobile phones */
        @media (max-width: 480px) {
            .menu-toggle {
                top: 10px;
                left: 10px;
                min-height: 48px;
                min-width: 48px;
            }
            
            .sidebar {
                width: 90vw;
                max-width: 300px;
            }
            
            .slide-header {
                padding: 12px 16px;
            }
            
            .slide-title {
                font-size: 1.1rem;
            }
            
            .slide {
                padding: 16px 12px;
            }
            
            .slide h2, .slide h3 {
                font-size: 1.2rem;
            }
            
            .slide p {
                font-size: 0.95rem;
            }
            
            .slide-navigation {
                padding: 12px 16px;
            }
            
            .nav-btn {
                font-size: 0.85rem;
                padding: 8px 16px;
                min-height: 44px;
            }
            
            .notes-section {
                padding: 16px;
                margin-top: 16px;
            }
            
            .video-placeholder {
                height: 150px;
                font-size: 0.85rem;
            }
            
            .ai-help-widget {
                top: 10px;
                right: 10px;
            }
            
            .ai-help-toggle {
                width: 48px;
                height: 48px;
                font-size: 1.2rem;
            }
            
            .ai-help-panel {
                width: calc(100vw - 30px);
                right: 5px;
            }
        }

        /* Landscape mobile orientation */
        @media (max-width: 768px) and (orientation: landscape) {
            .slide-container {
                height: 100vh;
            }
            
            .slide-content {
                padding: 16px;
            }
            
            .slide {
                padding: 16px;
            }
            
            .main-slide-area {
                min-height: 200px;
            }
            
            .video-placeholder {
                height: 140px;
            }
            
            .sidebar {
                width: 70vw;
                max-width: 280px;
            }
        }

        /* Touch improvements */
        @media (hover: none) and (pointer: coarse) {
            .nav-btn:hover,
            .menu-toggle:hover,
            .ai-help-toggle:hover,
            .quiz-option:hover,
            .subtopic-btn:hover,
            .back-home-btn:hover,
            .ai-suggestion:hover {
                transform: none;
                box-shadow: inherit;
            }
            
            .nav-btn:active,
            .menu-toggle:active,
            .ai-help-toggle:active,
            .subtopic-btn:active,
            .back-home-btn:active,
            .ai-suggestion:active {
                transform: scale(0.98);
            }
            
            .quiz-option:active {
                transform: scale(0.99);
            }
        }
    </style>
</head>
<body>

<div class="sidebar-overlay" id="sidebar-overlay"></div>

<button class="menu-toggle" id="menu-toggle" onclick="toggleSidebar()">
    ‚ò∞
</button>

<div class="slide-modal" id="slide-modal">
    <div class="sidebar" id="sidebar">
        <!-- Subtopics will be rendered here -->
    </div>
    
    <div class="slide-container">
        <div class="slide-header">
            <span style="display:flex;align-items:center;">
                <h2 class="slide-title" style="margin:0;">
                    <span id="slide-icon">üå±</span>
                    <span id="slide-title-text">Living & Non-Living Things</span>
                </h2>
            </span>
            <span style="display:flex;align-items:center;flex-wrap:wrap;gap:8px;">
                <div class="slide-counter" id="slide-counter" style="display:inline-block;">1 / 20</div>
                <a href="{{ url_for('/learn/Primary4') }}"   class="back-home-btn">üè† Back to Home</a>
            </span>
        </div>
        
        <div class="slide-content" id="slide-content">
            <div class="main-slide-area" id="main-slide-area"></div>
        </div>
        
        <div class="slide-navigation">
            <div class="slide-progress" id="slide-progress"></div>
            <button class="nav-btn" id="prev-slide-btn" onclick="previousSlide()" disabled>‚Üê Previous</button>
            <button class="nav-btn" id="next-slide-btn" onclick="nextSlide()">Next ‚Üí</button>
        </div>
    </div>
</div>

<!-- AI Help Widget -->
<div class="ai-help-widget">
    <button class="ai-help-toggle" id="ai-help-toggle" onclick="toggleAIHelp()">ü§ñ</button>
    <div class="ai-help-panel" id="ai-help-panel">
        <div class="ai-help-header">
            <span>ü§ñ</span>
            <span>BB AI Assistant</span>
        </div>
        <div class="ai-help-content">
            <div class="ai-suggestions">
                <button class="ai-suggestion" onclick="askAI('Explain living things')">Explain living things</button>
                <button class="ai-suggestion" onclick="askAI('What is diversity?')">What is diversity?</button>
                <button class="ai-suggestion" onclick="askAI('Help with quiz')">Help with quiz</button>
            </div>
            <div class="ai-chat-messages" id="ai-chat-messages">
                <div class="ai-message bot">
                    Hi! I'm BB AI, your learning assistant. Ask me anything about this lesson! üòä
                </div>
            </div>
            <div class="ai-input-area">
                <input type="text" class="ai-input" id="ai-input" placeholder="Ask me anything..." onkeypress="handleAIKeyPress(event)">
                <button class="ai-send-btn" onclick="sendAIMessage()">‚û§</button>
            </div>
        </div>
    </div>
</div>

<script>
// Slide data
const subtopicSections = [
    {
        title: "Living & Non-Living Things",
        subtopics: [
            { title: "Introduction to Diversity", slideIndex: 0 },
            { title: "What is Diversity?", slideIndex: 1 },
            { title: "Living Things", slideIndex: 2 },
            { title: "Non-Living Things", slideIndex: 3 },
            { title: "Characteristics of Living Things", slideIndex: 4 },
            { title: "Classification Systems", slideIndex: 5 },
            { title: "Plants", slideIndex: 6 },
            { title: "Animals", slideIndex: 7 },
            { title: "Fungi", slideIndex: 8 },
            { title: "Microorganisms", slideIndex: 9 }
        ]
    },
    {
        title: "Diversity of Materials",
        subtopics: [
            { title: "Types of Materials", slideIndex: 10 },
            { title: "Natural Materials", slideIndex: 11 },
            { title: "Man-made Materials", slideIndex: 12 },
            { title: "Uses of Materials", slideIndex: 13 },
            { title: "Grouping Materials", slideIndex: 14 },
            { title: "Importance of Diversity", slideIndex: 15 },
            { title: "Review", slideIndex: 16 },
            { title: "Quiz Preparation", slideIndex: 17 },
            { title: "Quiz 1", slideIndex: 18 },
            { title: "Quiz 2", slideIndex: 19 }
        ]
    }
];

const slides = [
    {
        content: `
            <div class="slide-icon">üå±</div>
            <h2>Welcome to Diversity!</h2>
            <div class="video-container">
                <div class="video-placeholder">
                    üé¨ Educational Video: Living vs Non-Living Things
                </div>
            </div>
            <p>Let's explore living and non-living things and the diversity of materials.</p>
        `,
        notes: {
            text: "Diversity is everywhere around us! In this lesson, we'll discover how scientists classify the amazing variety of living and non-living things in our world. Pay attention to the key characteristics that help us tell living things apart from non-living things.",
            images: ["üå≥ Trees and plants", "ü™® Rocks and minerals"]
        }
    },
    {
        content: `
            <h3>What is Diversity?</h3>
            <p>Diversity means variety. In science, it refers to the many different types of things in our world.</p>
            <div class="grid-2">
                <div class="info-card green-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ü¶ã</div>
                    <p><strong>Different Animals</strong></p>
                </div>
                <div class="info-card blue-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">üå∏</div>
                    <p><strong>Various Plants</strong></p>
                </div>
            </div>
        `,
        notes: {
            text: "Think about all the different animals, plants, and materials you see every day. From tiny ants to huge elephants, from soft cotton to hard steel - this variety is what we call diversity!",
            images: ["ü¶ã Different butterflies", "üå∏ Various flowers"]
        }
    },
    {
        content: `
            <h3>Living Things</h3>
            <p>Living things can grow, move, breathe, reproduce, and respond to their environment.</p>
            <div class="mrs-gren">
                <h4>Remember MRS GREN:</h4>
                <ul>
                    <li><strong>M</strong>ovement - Can move or change position</li>
                    <li><strong>R</strong>espiration - Need to breathe or get energy</li>
                    <li><strong>S</strong>ensitivity - Respond to their environment</li>
                    <li><strong>G</strong>rowth - Get bigger over time</li>
                    <li><strong>R</strong>eproduction - Can make babies</li>
                    <li><strong>E</strong>xcretion - Get rid of waste</li>
                    <li><strong>N</strong>utrition - Need food or make their own</li>
                </ul>
            </div>
        `,
        notes: {
            text: "Remember MRS GREN to identify living things: Movement, Respiration, Sensitivity, Growth, Reproduction, Excretion, Nutrition. All living things need these seven characteristics!",
            images: ["üê± Animals moving", "üå± Plants growing"]
        }
    },
    {
        content: `
            <h3>Non-Living Things</h3>
            <p>Non-living things do not grow, move, or reproduce on their own.</p>
            <div class="grid-3">
                <div class="info-card gray-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ü™®</div>
                    <p><strong>Rocks</strong></p>
                </div>
                <div class="info-card blue-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">üíß</div>
                    <p><strong>Water</strong></p>
                </div>
                <div class="info-card yellow-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">üí®</div>
                    <p><strong>Air</strong></p>
                </div>
            </div>
        `,
        notes: {
            text: "Non-living things don't have the seven characteristics of life. They can't grow on their own, don't need food, and can't make babies. But they're still very important in our world!",
            images: ["ü™® Different rocks", "üíß Water droplets"]
        }
    },
    {
        content: `
            <h3>Characteristics of Living Things</h3>
            <p>All living things share basic needs and abilities.</p>
            <div class="grid-2">
                <div class="info-card green-card">
                    <h4>Basic Needs:</h4>
                    <ul>
                        <li>üçé Food or ability to make food</li>
                        <li>üíß Water</li>
                        <li>üí® Air (oxygen)</li>
                        <li>üè† Suitable environment</li>
                    </ul>
                </div>
                <div class="info-card blue-card">
                    <h4>Life Processes:</h4>
                    <ul>
                        <li>üìà Growth and development</li>
                        <li>üë∂ Reproduction</li>
                        <li>üîÑ Response to environment</li>
                        <li>‚ö° Energy use</li>
                    </ul>
                </div>
            </div>
        `,
        notes: {
            text: "All living things share these basic needs. Plants make their own food through photosynthesis, while animals must eat other living things. Both need water and air to survive.",
            images: ["üçé Food sources", "üí® Air and breathing"]
        }
    },
    {
        content: `
            <h3>Classification Systems</h3>
            <p>Scientists organize living things into groups based on their similarities.</p>
            <div class="info-card purple-card">
                <div style="font-size: 2.5rem; margin-bottom: 15px;">üî¨</div>
                <h4>Main Groups of Living Things:</h4>
                <div class="grid-2" style="margin-top: 15px;">
                    <div>üåø <strong>Plants</strong> - Make their own food</div>
                    <div>üêæ <strong>Animals</strong> - Move and eat other living things</div>
                    <div>üçÑ <strong>Fungi</strong> - Break down dead things</div>
                    <div>ü¶† <strong>Microorganisms</strong> - Too small to see</div>
                </div>
            </div>
        `,
        notes: {
            text: "Scientists organize living things into groups based on their similarities. This makes it easier to study and understand the incredible diversity of life on Earth.",
            images: ["üìä Classification chart", "üî¨ Scientific grouping"]
        }
    },
    {
        content: `
            <h3>Plants</h3>
            <p>Plants make their own food using sunlight through photosynthesis.</p>
            <div class="info-card green-card">
                <h4>Plant Parts and Functions:</h4>
                <div class="grid-2" style="margin-top: 15px;">
                    <div><strong>üåø Roots:</strong> Absorb water and nutrients</div>
                    <div><strong>üå± Stem:</strong> Support and transport</div>
                    <div><strong>üçÉ Leaves:</strong> Make food using sunlight</div>
                    <div><strong>üå∏ Flowers:</strong> Reproduction and seeds</div>
                </div>
            </div>
            <div class="info-card yellow-card" style="margin-top: 20px;">
                <p><strong>Photosynthesis:</strong> Plants use sunlight + water + carbon dioxide = food + oxygen</p>
            </div>
        `,
        notes: {
            text: "Plants are amazing food factories! They use sunlight, water, and carbon dioxide to make their own food through photosynthesis. The green substance chlorophyll helps capture sunlight.",
            images: ["üåø Plant parts diagram", "‚òÄÔ∏è Sunlight and leaves"]
        }
    },
    {
        content: `
            <h3>Animals</h3>
            <p>Animals move around and eat other living things for food.</p>
            <div class="grid-3">
                <div class="info-card red-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ü¶Å</div>
                    <p><strong>Carnivores</strong></p>
                    <p style="font-size: 0.9rem;">Eat other animals</p>
                </div>
                <div class="info-card green-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">üê∞</div>
                    <p><strong>Herbivores</strong></p>
                    <p style="font-size: 0.9rem;">Eat plants</p>
                </div>
                <div class="info-card orange-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">üêª</div>
                    <p><strong>Omnivores</strong></p>
                    <p style="font-size: 0.9rem;">Eat both</p>
                </div>
            </div>
            <p style="color: #718096;">Animals have different ways of getting food based on what they eat!</p>
        `,
        notes: {
            text: "Unlike plants, animals can't make their own food. They must eat plants or other animals to get energy. Animals can move from place to place to find food and shelter.",
            images: ["ü¶Å Predator animals", "üê∞ Herbivore animals"]
        }
    },
    {
        content: `
            <h3>Fungi</h3>
            <p>Fungi like mushrooms cannot make their own food. They break down dead things.</p>
            <div class="info-card orange-card">
                <div style="font-size: 2.5rem; margin-bottom: 15px;">üçÑ</div>
                <h4>Nature's Recyclers!</h4>
                <div style="text-align: left; margin-top: 15px;">
                    <p>üîÑ <strong>Decomposers:</strong> Break down dead plants and animals</p>
                    <p>üå± <strong>Nutrient Cycle:</strong> Return nutrients to soil for new plants</p>
                    <p>üè† <strong>Hidden Life:</strong> Most fungi live underground or inside dead wood</p>
                    <p>üçÑ <strong>Mushrooms:</strong> Just the visible "fruit" of the fungus</p>
                </div>
            </div>
        `,
        notes: {
            text: "Fungi are nature's recyclers! They break down dead plants and animals, returning nutrients to the soil. Mushrooms are just the visible part - most fungi live underground.",
            images: ["üçÑ Different mushrooms", "üßΩ Fungi structures"]
        }
    },
    {
        content: `
            <h3>Microorganisms</h3>
            <p>Some living things are so small we need a microscope to see them!</p>
            <div class="info-card blue-card">
                <div style="font-size: 2.5rem; margin-bottom: 15px;">üî¨</div>
                <h4>The Microscopic World</h4>
                <div class="grid-2" style="margin-top: 15px;">
                    <div>
                        <p>ü¶† <strong>Bacteria:</strong> Single-celled organisms</p>
                        <p>üåä <strong>Algae:</strong> Tiny water plants</p>
                    </div>
                    <div>
                        <p>üß´ <strong>Helpful:</strong> Help digest food, make medicine</p>
                        <p>üò∑ <strong>Harmful:</strong> Some cause diseases</p>
                    </div>
                </div>
            </div>
        `,
        notes: {
            text: "The microscopic world is full of tiny living things like bacteria and viruses. Some are helpful (like those that help us digest food), while others can make us sick.",
            images: ["üî¨ Microscope view", "ü¶† Microorganism shapes"]
        }
    },
    {
        content: `
            <h3>Diversity of Materials</h3>
            <p>Materials around us can be natural or man-made.</p>
            <div class="grid-2">
                <div class="info-card green-card">
                    <h4>üåø Natural Materials</h4>
                    <ul>
                        <li>üå≤ Wood from trees</li>
                        <li>üêë Wool from sheep</li>
                        <li>üåæ Cotton from plants</li>
                        <li>ü™® Stone from earth</li>
                    </ul>
                </div>
                <div class="info-card blue-card">
                    <h4>üè≠ Man-made Materials</h4>
                    <ul>
                        <li>ü•§ Plastic from oil</li>
                        <li>ü™ü Glass from sand</li>
                        <li>üî© Steel from iron</li>
                        <li>üß± Concrete from cement</li>
                    </ul>
                </div>
            </div>
        `,
        notes: {
            text: "Look around you - everything is made of materials! Some come directly from nature, while others are created by humans using natural resources as starting materials.",
            images: ["üå≤ Natural materials", "üè≠ Man-made materials"]
        }
    },
    {
        content: `
            <h3>Natural Materials</h3>
            <p>Come from plants, animals, or the earth. Examples: wood, wool, stone.</p>
            <div class="grid-2">
                <div class="info-card green-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">üå≤</div>
                    <h4>From Plants</h4>
                    <p>Wood, cotton, rubber, paper</p>
                </div>
                <div class="info-card orange-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">üêë</div>
                    <h4>From Animals</h4>
                    <p>Wool, silk, leather, fur</p>
                </div>
            </div>
            <div class="info-card gray-card" style="margin-top: 20px;">
                <div style="font-size: 2rem; margin-bottom: 10px;">ü™®</div>
                <h4>From Earth</h4>
                <p>Stone, metals, clay, sand</p>
            </div>
        `,
        notes: {
            text: "Natural materials are gifts from nature. Wood comes from trees, wool from sheep, cotton from plants, and metals from rocks deep in the earth.",
            images: ["üêë Wool from sheep", "üå∞ Wood from trees"]
        }
    },
    {
        content: `
            <h3>Man-made Materials</h3>
            <p>Made by people using natural resources. Examples: plastic, glass, steel.</p>
            <div class="grid-2">
                <div class="info-card blue-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ü•§</div>
                    <h4>Plastics</h4>
                    <p>Made from oil and chemicals</p>
                </div>
                <div class="info-card purple-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ü™ü</div>
                    <h4>Glass</h4>
                    <p>Made from sand heated very hot</p>
                </div>
            </div>
            <div class="info-card gray-card" style="margin-top: 20px;">
                <div style="font-size: 2rem; margin-bottom: 10px;">üî©</div>
                <h4>Metals</h4>
                <p>Steel, aluminum, processed from ores</p>
            </div>
        `,
        notes: {
            text: "Humans are clever inventors! We've learned to create new materials by mixing, heating, and changing natural materials. Plastic comes from oil, glass from sand!",
            images: ["ü•§ Plastic items", "ü™ü Glass objects"]
        }
    },
    {
        content: `
            <h3>Uses of Materials</h3>
            <p>We choose materials based on their properties: strong, waterproof, flexible, etc.</p>
            <div class="grid-2">
                <div class="info-card blue-card">
                    <h4>üèóÔ∏è Strong Materials</h4>
                    <p>Steel for buildings, concrete for foundations</p>
                </div>
                <div class="info-card green-card">
                    <h4>üß• Flexible Materials</h4>
                    <p>Cotton for clothes, rubber for tires</p>
                </div>
            </div>
            <div class="grid-2" style="margin-top: 20px;">
                <div class="info-card yellow-card">
                    <h4>üíß Waterproof Materials</h4>
                    <p>Plastic for raincoats, rubber for boots</p>
                </div>
                <div class="info-card purple-card">
                    <h4>üî• Heat-resistant Materials</h4>
                    <p>Metal for cooking pots, ceramic for ovens</p>
                </div>
            </div>
        `,
        notes: {
            text: "Smart material choice is important! We use waterproof materials for raincoats, strong materials for buildings, and flexible materials for clothing.",
            images: ["üèóÔ∏è Strong materials", "üß• Flexible materials"]
        }
    },
    {
        content: `
            <h3>Grouping Materials</h3>
            <p>We can group materials by what they are made of or how they are used.</p>
            <div class="info-card purple-card">
                <h4>üìã Ways to Group Materials:</h4>
                <div style="text-align: left; margin-top: 15px;">
                    <p>üåø <strong>By Source:</strong> Natural vs Man-made</p>
                    <p>üí™ <strong>By Properties:</strong> Hard vs Soft, Rough vs Smooth</p>
                    <p>üè† <strong>By Use:</strong> Building materials, Clothing materials</p>
                    <p>üîß <strong>By Behavior:</strong> Magnetic vs Non-magnetic</p>
                </div>
            </div>
        `,
        notes: {
            text: "Materials can be grouped in many ways: by their source (natural/man-made), by their properties (hard/soft), or by their use (building/clothing).",
            images: ["üìã Material groups", "üîß Material properties"]
        }
    },
    {
        content: `
            <h3>Why is Diversity Important?</h3>
            <p>Diversity helps living things survive and adapt to changes.</p>
            <div class="info-card green-card">
                <div style="font-size: 2.5rem; margin-bottom: 15px;">üåç</div>
                <h4>Nature's Insurance Policy!</h4>
                <div style="text-align: left; margin-top: 15px;">
                    <p>üîÑ <strong>Adaptation:</strong> Different species can survive different changes</p>
                    <p>‚öñÔ∏è <strong>Balance:</strong> Each species has a role in the ecosystem</p>
                    <p>üß¨ <strong>Genetics:</strong> Variety helps species stay healthy</p>
                    <p>üå± <strong>Resources:</strong> Different materials serve different purposes</p>
                </div>
            </div>
        `,
        notes: {
            text: "Diversity is like nature's insurance policy! When environments change, some species can survive because they're different. This keeps ecosystems healthy and balanced.",
            images: ["üåç Ecosystem balance", "üîÑ Adaptation examples"]
        }
    },
    {
        content: `
            <h3>Review</h3>
            <p>Living things, non-living things, and materials are all around us!</p>
            <div class="grid-2">
                <div class="info-card green-card">
                    <h4>‚úÖ Key Concepts:</h4>
                    <ul>
                        <li>MRS GREN characteristics</li>
                        <li>Living vs Non-living</li>
                        <li>Classification of life</li>
                        <li>Natural vs Man-made materials</li>
                    </ul>
                </div>
                <div class="info-card blue-card">
                    <h4>üìö What We Learned:</h4>
                    <ul>
                        <li>How to identify living things</li>
                        <li>Different groups of organisms</li>
                        <li>Material properties and uses</li>
                        <li>Why diversity matters</li>
                    </ul>
                </div>
            </div>
        `,
        notes: {
            text: "Great job learning about diversity! Remember the key differences between living and non-living things, and how we classify the amazing variety of materials in our world.",
            images: ["‚úÖ Review checklist", "üìö Key concepts"]
        }
    },
    {
        content: `
            <h3>Get Ready for a Quiz!</h3>
            <p>Let's test your knowledge about diversity!</p>
            <div class="info-card yellow-card">
                <div style="font-size: 2.5rem; margin-bottom: 15px;">üéØ</div>
                <h4>Quiz Topics:</h4>
                <div style="text-align: left; margin-top: 15px;">
                    <p>üå± <strong>Living Things:</strong> MRS GREN characteristics</p>
                    <p>ü™® <strong>Non-living Things:</strong> What makes them different</p>
                    <p>üî¨ <strong>Classification:</strong> Groups of living things</p>
                    <p>üè≠ <strong>Materials:</strong> Natural vs man-made</p>
                    <p>üåç <strong>Diversity:</strong> Why it's important</p>
                </div>
            </div>
        `,
        notes: {
            text: "Time to show what you've learned! Think about the characteristics of living things, the differences between natural and man-made materials, and why diversity matters.",
            images: ["üéØ Quiz preparation", "üß† Knowledge check"]
        }
    },
    {
        content: `
            <h3>Quiz 1</h3>
            <div style="margin: 20px 0;">
                <div style="font-size: 1.2rem; margin-bottom: 20px; font-weight: 600;">Which of these is a living thing?</div>
                <div style="display: flex; flex-direction: column; gap: 10px; max-width: 600px; margin: 0 auto;">
                    <button-direction: column; gap: 10px; max-width: 600px; margin: 0 auto;">
                    <button class="quiz-option" onclick="selectQuizAnswer(this, true, 18)">A tree</button>
                    <button class="quiz-option" onclick="selectQuizAnswer(this, false, 18)">A rock</button>
                    <button class="quiz-option" onclick="selectQuizAnswer(this, false, 18)">A car</button>
                    <button class="quiz-option" onclick="selectQuizAnswer(this, false, 18)">A table</button>
                </div>
            </div>
            <div class="quiz-explanation" id="explanation18">
                <strong>Correct!</strong> A tree is a living thing because it grows, makes its own food through photosynthesis, and has all the MRS GREN characteristics.
            </div>
        `,
        notes: {
            text: "Remember MRS GREN! A tree can grow, reproduce (make seeds), respond to sunlight, and make its own food through photosynthesis.",
            images: ["üå≥ Tree characteristics", "üìù Living thing checklist"]
        }
    },
    {
        content: `
            <h3>Quiz 2</h3>
            <div style="margin: 20px 0;">
                <div style="font-size: 1.2rem; margin-bottom: 20px; font-weight: 600;">Which is a man-made material?</div>
                <div style="display: flex; flex-direction: column; gap: 10px; max-width: 600px; margin: 0 auto;">
                    <button class="quiz-option" onclick="selectQuizAnswer(this, false, 19)">Wood</button>
                    <button class="quiz-option" onclick="selectQuizAnswer(this, false, 19)">Cotton</button>
                    <button class="quiz-option" onclick="selectQuizAnswer(this, true, 19)">Plastic</button>
                    <button class="quiz-option" onclick="selectQuizAnswer(this, false, 19)">Wool</button>
                </div>
            </div>
            <div class="quiz-explanation" id="explanation19">
                <strong>Correct!</strong> Plastic is made by people from oil and chemicals. Wood comes from trees, cotton from plants, and wool from sheep - all natural sources!
            </div>
        `,
        notes: {
            text: "Plastic is created by humans from oil and chemicals. Wood comes from trees, cotton from plants, and wool from sheep - all natural sources!",
            images: ["üè≠ Plastic factory", "üåø Natural sources"]
        }
    }
];

let currentSlideIndex = 0;
let sidebarOpen = false;
let aiHelpOpen = false;
let sidebarTouchStartX = 0;
let sidebarTouchEndX = 0;

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const slideModal = document.getElementById('slide-modal');
    const menuToggle = document.getElementById('menu-toggle');
    const overlay = document.getElementById('sidebar-overlay');
    
    sidebarOpen = !sidebarOpen;
    
    if (sidebarOpen) {
        sidebar.classList.add('open');
        slideModal.classList.add('sidebar-open');
        menuToggle.classList.add('sidebar-open');
        menuToggle.innerHTML = '‚úï';
        overlay.classList.add('show');
        document.body.style.overflow = 'hidden';
    } else {
        sidebar.classList.remove('open');
        slideModal.classList.remove('sidebar-open');
        menuToggle.classList.remove('sidebar-open');
        menuToggle.innerHTML = '‚ò∞';
        overlay.classList.remove('show');
        document.body.style.overflow = '';
    }
}

function toggleAIHelp() {
    const panel = document.getElementById('ai-help-panel');
    const toggle = document.getElementById('ai-help-toggle');
    
    aiHelpOpen = !aiHelpOpen;
    
    if (aiHelpOpen) {
        panel.classList.add('open');
        toggle.classList.add('active');
        toggle.innerHTML = '‚úï';
    } else {
        panel.classList.remove('open');
        toggle.classList.remove('active');
        toggle.innerHTML = 'ü§ñ';
    }
}

function askAI(question) {
    const input = document.getElementById('ai-input');
    input.value = question;
    sendAIMessage();
}

function sendAIMessage() {
    const input = document.getElementById('ai-input');
    const messages = document.getElementById('ai-chat-messages');
    const question = input.value.trim();
    
    if (!question) return;
    
    const userMessage = document.createElement('div');
    userMessage.className = 'ai-message user';
    userMessage.textContent = question;
    messages.appendChild(userMessage);
    
    input.value = '';
    
    setTimeout(() => {
        const botMessage = document.createElement('div');
        botMessage.className = 'ai-message bot';
        botMessage.textContent = generateAIResponse(question);
        messages.appendChild(botMessage);
        messages.scrollTop = messages.scrollHeight;
    }, 1000);
    
    messages.scrollTop = messages.scrollHeight;
}

function generateAIResponse(question) {
    const responses = {
        'explain living things': 'Living things have 7 key characteristics: Movement, Respiration, Sensitivity, Growth, Reproduction, Excretion, and Nutrition (MRS GREN). They can respond to their environment and need food, water, and air to survive! üå±',
        'what is diversity': 'Diversity means variety! It\'s all the different types of living things, materials, and objects in our world. Think of all the different animals, plants, and materials you see around you - that\'s diversity! üåç',
        'help with quiz': 'Remember the key points: Living things grow and reproduce, non-living things don\'t. Natural materials come from nature (wood, wool), man-made materials are created by humans (plastic, glass). You\'ve got this! üí™',
        'natural materials': 'Natural materials come directly from nature - like wood from trees, cotton from plants, wool from sheep, and stone from the earth. They\'re not made by humans! üåø',
        'man-made materials': 'Man-made materials are created by humans, like plastic (from oil), glass (from sand), and steel (from iron). We use technology to make these! üè≠'
    };
    
    const key = question.toLowerCase();
    for (const [keyword, response] of Object.entries(responses)) {
        if (key.includes(keyword.replace(/\s+/g, '')) || key.includes(keyword)) {
            return response;
        }
    }
    
    return `That's a great question about diversity! Based on slide ${currentSlideIndex + 1}, I'd suggest focusing on the key concepts we've covered. Feel free to ask more specific questions! üòä`;
}

function handleAIKeyPress(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
        sendAIMessage();
    }
}

function renderSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.innerHTML = '';
    
    subtopicSections.forEach(section => {
        const headerDiv = document.createElement('div');
        headerDiv.className = 'subtopic-section';
        
        const header = document.createElement('div');
        header.className = 'subtopic-header';
        header.textContent = section.title;
        headerDiv.appendChild(header);
        
        section.subtopics.forEach(subtopic => {
            const btn = document.createElement('button');
            btn.className = 'subtopic-btn' + (currentSlideIndex === subtopic.slideIndex ? ' active' : '');
            btn.textContent = subtopic.title;
            btn.onclick = () => {
                currentSlideIndex = subtopic.slideIndex;
                loadSlide();
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            };
            headerDiv.appendChild(btn);
        });
        
        sidebar.appendChild(headerDiv);
    });
}

function loadSlide() {
    const slideContentEl = document.getElementById('slide-content');
    
    slideContentEl.innerHTML = '';
    
    const mainArea = document.createElement('div');
    mainArea.className = 'main-slide-area';
    mainArea.id = 'main-slide-area';
    
    const slideEl = document.createElement('div');
    slideEl.className = 'slide active';
    slideEl.innerHTML = slides[currentSlideIndex].content;
    mainArea.appendChild(slideEl);
    
    slideContentEl.appendChild(mainArea);
    
    if (slides[currentSlideIndex].notes) {
        const notesSection = document.createElement('div');
        notesSection.className = 'notes-section';
        
        notesSection.innerHTML = `
            <div class="notes-header">
                <span>üìù</span>
                <span>Study Notes</span>
            </div>
            <div class="notes-content">
                <div class="notes-text">
                    ${slides[currentSlideIndex].notes.text}
                </div>
                <div class="notes-images">
                    ${slides[currentSlideIndex].notes.images.map(img => 
                        `<div class="bw-image">${img}</div>`
                    ).join('')}
                </div>
            </div>
        `;
        
        slideContentEl.appendChild(notesSection);
    }
    
    updateSlideCounter();
    updateNavigationButtons();
    updateSlideProgress();
    renderSidebar();
}

function updateSlideCounter() {
    document.getElementById('slide-counter').textContent = `${currentSlideIndex + 1} / ${slides.length}`;
}

function updateNavigationButtons() {
    document.getElementById('prev-slide-btn').disabled = currentSlideIndex === 0;
    document.getElementById('next-slide-btn').disabled = false;
    document.getElementById('next-slide-btn').textContent = (currentSlideIndex === slides.length - 1) ? 'Finish' : 'Next ‚Üí';
}

function updateSlideProgress() {
    const progressEl = document.getElementById('slide-progress');
    progressEl.innerHTML = '';
    for (let i = 0; i < slides.length; i++) {
        const dot = document.createElement('div');
        dot.className = 'progress-dot' + (i === currentSlideIndex ? ' active' : '');
        progressEl.appendChild(dot);
    }
}

function nextSlide() {
    if (currentSlideIndex < slides.length - 1) {
        currentSlideIndex++;
        loadSlide();
    } else {
        alert('Congratulations! You have completed the Living & Non-Living Things lesson!');
    }
}

function previousSlide() {
    if (currentSlideIndex > 0) {
        currentSlideIndex--;
        loadSlide();
    }
}

function selectQuizAnswer(button, isCorrect, slideNum) {
    const options = button.parentElement.querySelectorAll('.quiz-option');
    const explanation = document.getElementById(`explanation${slideNum}`);
    
    options.forEach(option => {
        option.disabled = true;
        option.style.pointerEvents = 'none';
    });
    
    button.classList.add('selected');
    
    if (isCorrect) {
        button.classList.add('correct');
    } else {
        button.classList.add('incorrect');
        options.forEach(option => {
            if (option.onclick.toString().includes('true')) {
                option.classList.add('correct');
            }
        });
    }
    
    explanation.classList.add('show');
}

let touchStartY = 0;
let touchEndY = 0;

document.addEventListener('touchstart', function(event) {
    touchStartY = event.changedTouches[0].screenY;
    if (sidebarOpen && event.target.closest('#sidebar')) {
        sidebarTouchStartX = event.changedTouches[0].screenX;
    }
}, false);

document.addEventListener('touchend', function(event) {
    touchEndY = event.changedTouches[0].screenY;
    if (sidebarOpen && event.target.closest('#sidebar')) {
        sidebarTouchEndX = event.changedTouches[0].screenX;
        handleSidebarSwipe();
    } else {
        handleSlideSwipe();
    }
}, false);

function handleSlideSwipe() {
    const swipeThreshold = 50;
    const swipeDistance = touchEndY - touchStartY;
    
    if (Math.abs(swipeDistance) > swipeThreshold) {
        if (swipeDistance > 0 && currentSlideIndex > 0) {
            previousSlide();
        } else if (swipeDistance < 0 && currentSlideIndex < slides.length - 1) {
            nextSlide();
        }
    }
}

function handleSidebarSwipe() {
    const swipeThreshold = 50;
    const swipeDistance = sidebarTouchEndX - sidebarTouchStartX;
    
    if (swipeDistance < -swipeThreshold && sidebarOpen) {
        toggleSidebar();
    }
}

document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menu-toggle');
    const overlay = document.getElementById('sidebar-overlay');
    
    if (sidebarOpen && !sidebar.contains(event.target) && !menuToggle.contains(event.target) && event.target === overlay) {
        if (window.innerWidth <= 768) {
            toggleSidebar();
        }
    }
});

document.addEventListener('click', function(event) {
    const aiWidget = document.querySelector('.ai-help-widget');
    const aiPanel = document.getElementById('ai-help-panel');
    
    if (aiHelpOpen && !aiWidget.contains(event.target)) {
        toggleAIHelp();
    }
});

let lastTouchEnd = 0;
document.addEventListener('touchend', function(event) {
    const now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
        event.preventDefault();
    }
    lastTouchEnd = now;
}, false);

window.addEventListener('orientationchange', function() {
    setTimeout(function() {
        document.body.style.display = 'none';
        document.body.offsetHeight;
        document.body.style.display = '';
        if (sidebarOpen) {
            toggleSidebar();
        }
    }, 100);
});

window.onload = function() {
    loadSlide();
    
    const viewport = document.querySelector('meta[name="viewport"]');
    if (viewport) {
        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
    }
};
</script>

</body>
</html>
